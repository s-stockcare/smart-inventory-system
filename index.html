<script>
let products = JSON.parse(localStorage.getItem("products")) || [];

function saveProducts(){
    localStorage.setItem("products", JSON.stringify(products));
}

function addProduct(){
    let name = document.getElementById("name").value;
    let quantity = parseInt(document.getElementById("quantity").value);
    let expiry = document.getElementById("expiry").value;

    if(!name || !quantity || !expiry){
        alert("Please fill all fields");
        return;
    }

    products.push({name, quantity, expiry});
    saveProducts();
    renderDashboard();
}

function renderDashboard(){
    let table = document.querySelector("table");
    table.innerHTML = `
        <tr>
            <th>Product</th>
            <th>Quantity</th>
            <th>Expiry Date</th>
            <th>Status</th>
        </tr>
    `;

    let today = new Date();
    let expiringSoon = 0;
    let lowStock = 0;
    let outStock = 0;

    products.forEach(p=>{
        let expiryDate = new Date(p.expiry);
        let diffDays = (expiryDate - today)/(1000*60*60*24);

        let status = "Good";
        let className = "status-good";

        if(p.quantity == 0){
            status = "Out of Stock";
            className = "status-danger";
            outStock++;
        } 
        else if(p.quantity <= 5){
            lowStock++;
        }

        if(diffDays <= 7){
            status = "Expiring Soon";
            className = "status-warning";
            expiringSoon++;
        }

        table.innerHTML += `
            <tr>
                <td>${p.name}</td>
                <td>${p.quantity}</td>
                <td>${p.expiry}</td>
                <td class="${className}">${status}</td>
            </tr>
        `;
    });

    document.querySelectorAll(".card p")[0].innerText = products.length;
    document.querySelectorAll(".card p")[1].innerText = expiringSoon;
    document.querySelectorAll(".card p")[2].innerText = lowStock;
    document.querySelectorAll(".card p")[3].innerText = outStock;
}

renderDashboard();
</script>
