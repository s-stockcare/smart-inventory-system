<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>StockCare Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
/* --- Simple professional CSS --- */
body{font-family:'Poppins',sans-serif;margin:0;padding:0;background:#f0f4f8;color:#111;}
header{padding:20px;background:#0ea5e9;color:white;text-align:center;font-size:24px;font-weight:600;}
.container{padding:20px;}
.card-container{display:flex;gap:15px;flex-wrap:wrap;margin-bottom:20px;}
.card{flex:1;min-width:150px;background:white;padding:15px;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,0.1);text-align:center;}
.card h3{margin:0;color:#0ea5e9;}
.card p{font-size:24px;margin:5px 0;font-weight:600;}
form{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:20px;}
form input, form button{padding:10px;border-radius:5px;border:1px solid #ccc;}
form button{background:#0ea5e9;color:white;border:none;cursor:pointer;}
table{width:100%;border-collapse:collapse;background:white;border-radius:10px;overflow:hidden;}
table th, table td{padding:12px;text-align:left;border-bottom:1px solid #eee;}
.status-good{color:green;font-weight:600;}
.status-warning{color:orange;font-weight:600;}
.status-danger{color:red;font-weight:600;}
.toast-container{position:fixed;top:20px;right:20px;z-index:9999;}
.toast{background:#f87171;color:white;padding:10px;margin-bottom:10px;border-radius:5px;box-shadow:0 2px 6px rgba(0,0,0,0.2);}
</style>
</head>
<body>

<header>StockCare - Smart Inventory Dashboard</header>
<div class="container">
    <div class="card-container">
        <div class="card"><h3>Total Products</h3><p id="total-products">0</p></div>
        <div class="card"><h3>Expiring Soon</h3><p id="expiring-soon">0</p></div>
        <div class="card"><h3>Low Stock</h3><p id="low-stock">0</p></div>
        <div class="card"><h3>Out of Stock</h3><p id="out-stock">0</p></div>
    </div>

    <form onsubmit="event.preventDefault(); addProduct();">
        <input type="text" id="name" placeholder="Product Name" required>
        <input type="number" id="quantity" placeholder="Quantity" required>
        <input type="date" id="expiry" required>
        <button type="submit">Add Product</button>
    </form>

    <table>
        <tr><th>Product</th><th>Quantity</th><th>Expiry Date</th><th>Status</th></tr>
    </table>

    <canvas id="stockChart" style="margin-top:30px;"></canvas>
    <canvas id="statusChart" style="margin-top:30px;"></canvas>
</div>

<div id="toast-container" class="toast-container"></div>

<script>
const API_URL = "http://localhost:5000"; // backend URL
let products=[], stockChart, statusChart;

async function fetchProducts(){
    const res = await fetch(`${API_URL}/products`);
    products = await res.json();
    renderDashboard();
}

async function addProduct(){
    const name=document.getElementById("name").value;
    const quantity=parseInt(document.getElementById("quantity").value);
    const expiry=document.getElementById("expiry").value;
    if(!name||!quantity||!expiry){alert("Fill all fields"); return;}
    await fetch(`${API_URL}/products`,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({name,quantity,expiry})
    });
    document.getElementById("name").value="";
    document.getElementById("quantity").value="";
    document.getElementById("expiry").value="";
    fetchProducts();
    showToast(`Product "${name}" added!`);
}

function showToast(message){
    const container=document.getElementById("toast-container");
    const toast=document.createElement("div");
    toast.className="toast"; toast.innerText=message;
    container.appendChild(toast);
    setTimeout(()=>{toast.remove();},5000);
}

function renderDashboard(){
    const table=document.querySelector("table");
    table.innerHTML=`<tr><th>Product</th><th>Quantity</th><th>Expiry Date</th><th>Status</th></tr>`;
    let today=new Date(),expiring=0,low=0,out=0,statusCounts={Good:0,Low:0,Out:0},expiringProducts=[];
    products.forEach(p=>{
        const expiryDate=new Date(p.expiry);
        const diffDays=(expiryDate-today)/(1000*60*60*24);
        let status="Good",className="status-good";
        if(p.quantity==0){status="Out of Stock";className="status-danger";out++;statusCounts.Out++;}
        else if(p.quantity<=5){status="Low Stock";className="status-warning";low++;statusCounts.Low++;}
        if(diffDays<=7){status="Expiring Soon";className="status-warning";expiring++;statusCounts.Low++; expiringProducts.push(p);}
        if(status==="Good"){statusCounts.Good++;}
        table.innerHTML+=`<tr><td>${p.name}</td><td>${p.quantity}</td><td>${p.expiry}</td><td class="${className}">${status}</td></tr>`;
    });
    document.getElementById("total-products").innerText=products.length;
    document.getElementById("expiring-soon").innerText=expiring;
    document.getElementById("low-stock").innerText=low;
    document.getElementById("out-stock").innerText=out;
    renderStockChart(products.map(p=>p.name),products.map(p=>p.quantity));
    renderStatusChart(statusCounts);
}

function renderStockChart(labels,data){
    const ctx=document.getElementById('stockChart').getContext('2d');
    if(stockChart) stockChart.destroy();
    stockChart=new Chart(ctx,{
        type:'bar',
        data:{labels, datasets:[{label:'Quantity',data,backgroundColor:'rgba(14,165,233,0.7)'}]},
        options:{responsive:true,animation:{duration:1000}}
    });
}

function renderStatusChart(statusCounts){
    const ctx=document.getElementById('statusChart').getContext('2d');
    if(statusChart) statusChart.destroy();
    statusChart=new Chart(ctx,{
        type:'pie',
        data:{labels:['Good','Low/Expiring','Out of Stock'], datasets:[{data:[statusCounts.Good,statusCounts.Low,statusCounts.Out],backgroundColor:['#22c55e','#facc15','#ef4444']}]},
        options:{responsive:true,animation:{duration:1000}}
    });
}

fetchProducts();
</script>
</body>
</html>